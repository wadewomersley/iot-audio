<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Audio Player</title>
    <script>
        function sendRequest(path, data) {
            var oReq = new XMLHttpRequest();
            oReq.open("PUT", "/api/" + path);
            oReq.send(JSON.stringify(data));
        }

        function playLink(e) {2
            e.preventDefault();
            var filename = decodeURIComponent(this.pathname.substring(1));

            sendRequest('play', { FileName: filename });
        };

        function changeStartupFile(e) {
            e.preventDefault();
            var inputs = document.getElementsByClassName('startupFile');
            var filename = this.value;

            for (var i = 0; i < inputs.length; i++) {
                if (this != inputs[i]) {
                    inputs[i].checked = false;
                }
            }

            sendRequest('startupFile', { filename: this.checked ? filename : null });
        };

        window.onload = function () {
            var settingsReq = new XMLHttpRequest();
            settingsReq.open("GET", "/api/settings");
            settingsReq.onload = function (ev) {
                var settings = JSON.parse(this.responseText);

                if (settings.Volume !== null) {
                    document.getElementById("volume").value = settings.Volume;
                }
                
                var playlistReq = new XMLHttpRequest();
                playlistReq.open("GET", "/api/playlist");
                playlistReq.onload = function (ev) {
                    var ul = document.getElementById('playlist');
                    var files = JSON.parse(this.responseText).Files;

                    for (var i = 0; i < files.length; i++) {
                        var li = document.createElement('li');
                        var link = document.createElement('a');

                        var input = document.createElement('input');
                        input.type = 'checkbox';
                        input.className = 'startupFile';
                        input.value = files[i].FileName;

                        link.href = files[i].FileName;
                        link.innerText = files[i].DisplayName;

                        li.appendChild(link);
                        li.appendChild(input);
                        ul.appendChild(li);
                        
                        if (files[i].FileName === settings.StartupFilename) {
                            input.checked = true;
                        }

                        link.onclick = playLink
                        input.onchange = changeStartupFile;
                    }
                };
                playlistReq.send();
            };
            settingsReq.send();

            document.getElementById("volume").onchange = function (e) {
                var vol = document.getElementById("volume").value;

                sendRequest('volume', { Volume: vol });
            };
        };
    </script>
</head>
<body>

<p>Click to Play</p>

<ul id="playlist"></ul>

<input type="range" id="volume" min="1" value="100" max="100" step="1">

</body>
</html>